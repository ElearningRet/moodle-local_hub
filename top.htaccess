    RewriteEngine On

# protect this script
    Redirect /local/moodleorg/top.htaccess http://moodle.org


#   Uncomment these three lines below to redirect for maintenance.  The IP is OURS
#    RewriteBase /
#    RewriteCond %{REMOTE_HOST} !^124\.169\.227\.78
#    RewriteRule .* http://www.moodle.com/sorry [R=302,L]

    # return error 500 for rss feeds temporarily - added by jordan
    #RewriteRule ^rss/file.php/(.*) /error500/index.php?e=500 [L,NC]

    # web worm trying to do remote includes, return 403 permission denied - added by jordan
    RewriteCond %{QUERY_STRING} d=http://
    RewriteRule (.*) - [F,L]

    # Block non moodle.[org|com|net] sites from hotlinking our theme files.
    RewriteCond %{HTTP_REFERER} !^$
    RewriteCond %{HTTP_REFERER} !^http://([a-z.]{2,}\.)?moodle\.(org|com|net)($|(/(.*))) [NC]
    #RewriteCond %{HTTP_REFERER} !^http://(\w+\.)?moodle\.(org|com|net)($|(/(.*))) [NC]
    # all theme requests
    RewriteRule ^theme/.*$ - [F,L]
    # or just certain files
    #RewriteRule ^theme/.*\.(js|css|jpg|gif|png|txt|html|php)$ - [F,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=release.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/Release_Notes? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=developer.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/Developer_documentation? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=credits.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/Credits? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=install.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/Administrator_documentation? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=philosophy.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/Philosophy? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=installamp.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/Administrator_documentation? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=upgrade.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/Administrator_documentation? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=cvs.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/CVS? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=teacher.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/Teacher_documentation? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=coding.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/Coding? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=future.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/Future? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=faq.html(.*)$
    RewriteRule ^doc/$ http://docs.moodle.org/en/FAQ? [R=301,L]

    RewriteCond %{QUERY_STRING} ^(.*)f(.*)=translation.html$
    RewriteRule ^doc/$ http://docs.moodle.org/en/Translation? [R=301,L]

    RewriteCond %{QUERY_STRING} ^id=10$
    RewriteRule ^course/view.php$ http://demo.moodle.com/? [R=301,L]

    RewriteCond %{QUERY_STRING} ^d=42952$
    RewriteRule ^mod/forum/discuss.php$ http://moodle.org/mod/forum/discuss.php?d=42954 [R=301,L]

    RewriteCond %{QUERY_STRING} ^id=893$
    RewriteRule ^mod/forum/view.php$ http://moodle.org/course/view.php?id=55 [R=301,L]

    RewriteCond %{QUERY_STRING} ^id=7169$
    RewriteRule ^mod/forum/view.php$ http://moodle.org/mod/data/view.php?d=54

    RewriteCond %{QUERY_STRING} ^id=7080$
    RewriteRule ^mod/resource/view.php$ http://moodle.org/mod/forum/view.php?id=7128 [R=301,L]

    RewriteRule ^wiki/(.*) http://docs.moodle.org/ [R=301,L]

    RewriteRule ^bugs/(.*) http://tracker.moodle.org/browse/MDL? [R=301,L]

    RewriteRule ^assets/skins/sam/yui_image.php http://moodle.org/theme/yui_image.php [R=301,L]

    #Redirect /bugs http://tracker.moodle.org/browse/MDL?from
    Redirect /xref http://xref.moodle.org
    Redirect /hosting http://moodle.com/hosting
    Redirect /helpdesk http://moodle.com/helpdesk
    Redirect /news/news.xml http://moodle.org/rss/file.php/1/1/forum/1/rss.xml

    Redirect /download.php http://download.moodle.org/download.php
    Redirect /docs http://docs.moodle.org
    Redirect /doc http://docs.moodle.org
    Redirect /support/forums http://moodle.org/forums

    Redirect /mozillahelp http://mozilla.org/editor/midasdemo/securityprefs.html?

    Redirect /mod/reading   http://moodle.org/mod/resource
    Redirect /RELEASE.html   http://docs.moodle.org/en/Release_Notes
    Redirect /donation   http://moodle.org/donations/
    Redirect /help   http://moodle.org/course/view.php?id=5
    Redirect /buzz   http://moodle.org/mod/data/view.php?id=6140
    Redirect /themes   http://moodle.org/mod/data/view.php?id=6552
    Redirect /philosophy http://docs.moodle.org/en/Philosophy
    Redirect /faq   http://docs.moodle.org/en/Category:FAQ
    Redirect /modules   http://moodle.org/mod/data/view.php?id=6009
    Redirect /cvs   http://moodle.org/mod/cvsadmin/view.php?cid=1
    Redirect /jobs   http://moodle.org/mod/data/view.php?d=54
    Redirect /books   http://moodle.org/mod/data/view.php?id=7246
    Redirect /useful.php   http://moodle.org/useful/

    Redirect /mod/newmodule_template.zip http://download.moodle.org/modules/NEWMODULE.zip

    #spammers
    Redirect /phpwcms http://www.google.com
    Redirect /bookmark4u http://google.com
    Redirect /_vti_bin http://www.google.com
    Redirect /MSOffice http://www.google.com
    Redirect /mod/forum/ws http://www.google.com


# top pages and dirs added to http://moodle.org/ - it is much easier to maintain all these in local plugin

    Redirect    /search               http://moodle.org/public/search/
    RewriteRule ^(favicon\.ico|invaders\.swf|moodle\.gif|nagvercheck\.php|phm\.php|phm_es\.php|phm_fr\.php|robots\.txt|upgradeinprogress\.html)$  local/moodleorg/top/$1 [L]
    RewriteRule ^(about|audio|cafepress|community|contact|development|donations|downloads|events|forums/my|forums|images|logo|network|news|other|public/search|public|register|security|sites|spam|stats|support/commercial|support|useful|userpics)($|(/(.*))) local/moodleorg/top/$1/$4 [L]
    RewriteRule ^theme/moodle2($|(/(.*))) local/moodleorg/top/theme/moodle2/$3 [L]

# plugins database
    RewriteRule ^plugins($|(/(.*))) local/plugins/$3 [L]

# cafepress - can be removed if updated to use /cafepress/
    RewriteRule ^local/cafepress($|(/(.*)))   local/moodleorg/top/cafepress/$3 [L]

# Apache ErrorDocument handler
    RewriteRule ^error($|(/(.*))) local/moodleorg/top/error/$3 [L]
